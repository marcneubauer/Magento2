#!/usr/bin/env bash

#aggravatedservices="../commerce-cif-magento-extension/AggregatedServices";
aggravatedservices="commerce-cif-magento-extension/AggregatedServices";
projectname="magecif"

# clone cif extension into local dir
echo "Cloning CIF Module locally";
git clone https://github.com/adobe/commerce-cif-magento-extension.git commerce-cif-magento-extension/

dockerdo() {
    docker exec -i ${projectname}_apache_1 /usr/bin/env bash -c "$1"
}

if [ -d src/app/code/Magento ]; then
  if [ -d ${aggravatedservices} ]; then
    echo "Copying commerce-cif-magento-extension/AggregatedServices into src";
    #ln -s ${aggravatedservices}  src/app/code/Magento;
    cp -R ${aggravatedservices}  src/app/code/Magento \
    && echo "Enabling Module";echo ""
    dockerdo "bin/magento setup:upgrade"
    dockerdo "bin/magento module:enable Magento_AggregatedServices"
    dockerdo "bin/magento setup:di:compile"
    dockerdo "bin/magento setup:static-content:deploy -f"
    dockerdo "bin/magento cache:clean"
    echo "";echo ""
  fi
fi
